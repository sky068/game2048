{"version":3,"sources":["../../../../../assets/scripts/scene/assets/scripts/scene/InitScene.js"],"names":["cc","Class","extends","Component","properties","onLoad","sys","isNative","baseLocalVersion","localStorage","getItem","setItem","BASE_LOCAL_VERSION","path","jsb","fileUtils","getWritablePath","HOT_UPDATE_SUB_PATH","removeDirectory","log","game","restart","init","debug","setDisplayStats","DEBUG_OPEN","window","i18n","require","zy","event","EventTarget","utils","HttpProxy","httpProxy","constData","shaderUtils","ui","cornerMng","device","audio","director","DataMng","dataMng","loadDataFromLocalFile","c","t","loadScene"],"mappings":";;;;;;AAAA;;;;;AAKAA,GAAGC,KAAH,CAAS;AACLC,iBAASF,GAAGG,SADP;AAELC,oBAAY,EAFP;;AAKLC,cALK,oBAKI;AACL;;;;AAIA,oBAAIL,GAAGM,GAAH,CAAOC,QAAX,EAAqB;AACjB,4BAAIC,mBAAmBR,GAAGM,GAAH,CAAOG,YAAP,CAAoBC,OAApB,CAA4B,oBAA5B,CAAvB;AACA;AACAV,2BAAGM,GAAH,CAAOG,YAAP,CAAoBE,OAApB,CAA4B,oBAA5B,EAAkDC,kBAAlD;AACA,4BAAIJ,oBAAoB,EAApB,IAA0BA,oBAAoBI,kBAAlD,EAAsE;AAClE;AACA,oCAAIC,OAAQ,CAACC,IAAIC,SAAJ,GAAgBD,IAAIC,SAAJ,CAAcC,eAAd,EAAhB,GAAkD,GAAnD,IAA0DC,mBAAtE;AACAH,oCAAIC,SAAJ,CAAcG,eAAd,CAA8BL,IAA9B;AACAb,mCAAGmB,GAAH,CAAO,iBAAiBN,IAAxB;AACA;AACAb,mCAAGoB,IAAH,CAAQC,OAAR;AACH,yBAPD,MAOO;AACH,qCAAKC,IAAL;AACH;AACJ,iBAdD,MAcO;AACH,6BAAKA,IAAL;AACH;;AAEDtB,mBAAGuB,KAAH,CAASC,eAAT,CAAyBC,UAAzB,EAvBK,CAuBiC;AACzC,SA7BI;AA+BLH,YA/BK,kBA+BE;AACHI,uBAAOC,IAAP,GAAcC,QAAQ,0BAAR,CAAd;;AAEA;AACAC,mBAAGC,KAAH,GAAW,IAAI9B,GAAG+B,WAAP,EAAX;;AAEAF,mBAAGG,KAAH,GAAWJ,QAAQ,kCAAR,CAAX;;AAEA;AACA,oBAAMK,YAAYL,QAAQ,8BAAR,CAAlB;AACAC,mBAAGK,SAAH,GAAc,IAAID,SAAJ,EAAd;;AAEA;AACAJ,mBAAGM,SAAH,GAAeP,QAAQ,qBAAR,CAAf;AACAC,mBAAGM,SAAH,CAAab,IAAb;;AAEA;AACAO,mBAAGO,WAAH,GAAiBR,QAAQ,mCAAR,CAAjB;AACAC,mBAAGO,WAAH,CAAed,IAAf;;AAEA;AACAO,mBAAGQ,EAAH,GAAQT,QAAQ,0BAAR,CAAR;AACAC,mBAAGQ,EAAH,CAAMf,IAAN;;AAEA;AACAO,mBAAGS,SAAH,GAAeV,QAAQ,iCAAR,CAAf;AACAC,mBAAGS,SAAH,CAAahB,IAAb,CAAkB,EAAlB;;AAEA;AACAO,mBAAGU,MAAH,GAAYX,QAAQ,8BAAR,CAAZ;AACAC,mBAAGU,MAAH,CAAUjB,IAAV;;AAEA;AACAO,mBAAGW,KAAH,GAAWZ,QAAQ,6BAAR,CAAX;AACAC,mBAAGW,KAAH,CAASlB,IAAT;;AAEA;AACAO,mBAAGY,QAAH,GAAcb,QAAQ,gCAAR,CAAd;AACAC,mBAAGY,QAAH,CAAYnB,IAAZ;;AAEA;AACA,oBAAMoB,UAAUd,QAAQ,mBAAR,CAAhB;AACAC,mBAAGc,OAAH,GAAa,IAAID,OAAJ,EAAb;AACAb,mBAAGc,OAAH,CAAWC,qBAAX,CAAiC,UAACC,CAAD,EAAIC,CAAJ,EAAQ;AACrC9C,2BAAGmB,GAAH,CAAO,uBAAP,EAAgC0B,CAAhC,EAAmCC,CAAnC;AACH,iBAFD,EAEG,YAAI;AACHjB,2BAAGY,QAAH,CAAYM,SAAZ,CAAsB,MAAtB;AACH,iBAJD;AAMH;AAhFI,CAAT","file":"InitScene.js","sourceRoot":"../../../../../assets/scripts/scene","sourcesContent":["/**\r\n * Created by skyxu on 2019/11/26.\r\n *\r\n * 初始化场景，处理游戏初始化等事务\r\n */\r\ncc.Class({\r\n    extends: cc.Component,\r\n    properties: {\r\n    },\r\n\r\n    onLoad() {\r\n        /**\r\n         * 更新包之后，删除热更新目录和记录\r\n         */\r\n\r\n        if (cc.sys.isNative) {\r\n            let baseLocalVersion = cc.sys.localStorage.getItem('BASE_LOCAL_VERSION');\r\n            // 写本地版本记录\r\n            cc.sys.localStorage.setItem('BASE_LOCAL_VERSION', BASE_LOCAL_VERSION);\r\n            if (baseLocalVersion != '' && baseLocalVersion != BASE_LOCAL_VERSION) {\r\n                // 大版本更新，需要删除之前热更新版本内容\r\n                let path = ((jsb.fileUtils ? jsb.fileUtils.getWritablePath() : '/') + HOT_UPDATE_SUB_PATH);\r\n                jsb.fileUtils.removeDirectory(path);\r\n                cc.log(\"大版本更新，path: \" + path);\r\n                // 重启\r\n                cc.game.restart();\r\n            } else {\r\n                this.init();\r\n            }\r\n        } else {\r\n            this.init();\r\n        }\r\n\r\n        cc.debug.setDisplayStats(DEBUG_OPEN); //隐藏左下方测试信息\r\n    },\r\n\r\n    init() {\r\n        window.i18n = require('./../framework/i18n/i18n');\r\n\r\n        // 全局事件管理器\r\n        zy.event = new cc.EventTarget();\r\n\r\n        zy.utils = require(\"./../framework/common/UtilsOther\");\r\n\r\n        // http代理\r\n        const HttpProxy = require(\"./../framework/net/HttpProxy\");\r\n        zy.httpProxy= new HttpProxy();\r\n\r\n        // 固定配置信息\r\n        zy.constData = require(\"./../data/ConstData\");\r\n        zy.constData.init();\r\n\r\n        // shader工具\r\n        zy.shaderUtils = require('./../framework/common/ShaderUtils');\r\n        zy.shaderUtils.init();\r\n\r\n        // 通用UI工具\r\n        zy.ui = require('./../framework/common/UI');\r\n        zy.ui.init();\r\n\r\n        // 红点系统\r\n        zy.cornerMng = require(\"./../framework/common/CornerMng\");\r\n        zy.cornerMng.init([]);\r\n\r\n        // 设备信息\r\n        zy.device = require('./../framework/common/Device');\r\n        zy.device.init();\r\n\r\n        // 音频管理\r\n        zy.audio = require(\"./../framework/common/Audio\");\r\n        zy.audio.init();\r\n\r\n        //--------以下放到最后处理-------\r\n        zy.director = require(\"./../framework/common/Director\");\r\n        zy.director.init();\r\n\r\n        // 配置表读取\r\n        const DataMng = require(\"./../data/DataMng\");\r\n        zy.dataMng = new DataMng();\r\n        zy.dataMng.loadDataFromLocalFile((c, t)=>{\r\n            cc.log(\"load local cfg: %d/%d\", c, t);\r\n        }, ()=>{\r\n            zy.director.loadScene(\"Game\");            \r\n        });\r\n\r\n    },\r\n});\r\n\r\n\r\n\r\n\r\n"]}