{"version":3,"sources":["../../../../../../../assets/scripts/framework/net/socket/assets/scripts/framework/net/socket/GameWebSocket.js"],"names":["GameWebSocketState","cc","Enum","CONNECTING","OPEN","CLOSING","CLOSED","GameWebSocketDelegate","Class","onSocketOpen","onSocketMessage","data","onSocketError","onSocketClosed","reason","GameWebSocketInterface","connect","send","close","getState","GameWebSocket","extends","properties","_address","_delegate","_webSocket","init","address","delegate","log","ws","WebSocket","onopen","bind","onmessage","param","onerror","onclose","stringOrBinary","err","toString","readyState","module","exports"],"mappings":"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","file":"GameWebSocket.js","sourceRoot":"../../../../../../../assets/scripts/framework/net/socket","sourcesContent":["/**\n * @enum {number}\n */\nvar GameWebSocketState = cc.Enum({\n    CONNECTING: 1,\n    OPEN: 2,\n    CLOSING: 3,\n    CLOSED: 4\n});\n\n/**\n * @interface\n */\nvar GameWebSocketDelegate = cc.Class({\n\n    onSocketOpen: function () {\n\n    },\n\n    /**\n     * 收到了消息\n     * @param {string|Uint8Array} data\n     */\n    onSocketMessage: function (data) {\n\n    },\n\n    onSocketError: function () {\n\n    },\n\n    /**\n     * 连接关闭\n     * @param {string} reason\n     */\n    onSocketClosed: function (reason) {\n\n    }\n});\n\n/**\n * @interface\n */\nvar GameWebSocketInterface = cc.Class({\n\n    connect: function () {\n\n    },\n\n    send: function () {\n\n    },\n\n    close: function () {\n\n    },\n\n    getState: function () {\n\n    }\n});\n\nvar GameWebSocket = cc.Class({\n    extends: GameWebSocketInterface,\n\n    properties: {\n\n        /**\n         * @type {String} 服务器地址\n         */\n        _address: null,\n\n        /**\n         * @type {GameWebSocketDelegate}\n         */\n        _delegate: null,\n\n        /**\n         * @type {WebSocket}\n         */\n        _webSocket: null,\n    },\n\n    /**\n     * @param {string} address 服务器地址\n     * @param {GameWebSocketDelegate} delegate 回调接口\n     */\n    init: function(address, delegate){\n        this._address = address;\n        this._delegate = delegate;\n        this._webSocket = null;\n    },\n\n    connect: function () {\n        cc.log('connect to '+ this._address);\n\n        var ws = this._webSocket = new WebSocket(this._address);\n        ws.onopen = this._delegate.onSocketOpen.bind(this._delegate);\n        ws.onmessage = function (param) {\n            this._delegate.onSocketMessage(param.data);\n        }.bind(this);\n        ws.onerror = this._delegate.onSocketError.bind(this._delegate);\n        // function({code: Number, reason: String, wasClean: Boolean})}\n        ws.onclose = function (param) {\n            this._delegate.onSocketClosed(param.reason);\n        }.bind(this);\n    },\n\n    /**\n     * 发送数据\n     * @param {string|Uint8Array} stringOrBinary\n     */\n    send: function (stringOrBinary) {\n        this._webSocket.send(stringOrBinary);\n    },\n\n    close: function () {\n        if (!this._webSocket) {\n            return;\n        }\n\n        try {\n            this._webSocket.close();\n        } catch (err) {\n            cc.log('error while closing webSocket', err.toString());\n        }\n        this._webSocket = null;\n    },\n\n    getState: function () {\n        if (this._webSocket) {\n            switch(this._webSocket.readyState){\n                case WebSocket.OPEN:\n                    return GameWebSocketState.OPEN;\n                case WebSocket.CONNECTING:\n                    return GameWebSocketState.CONNECTING;\n                case WebSocket.CLOSING:\n                    return GameWebSocketState.CLOSING;\n                case WebSocket.CLOSED:\n                    return GameWebSocketState.CLOSED;\n            }\n        }\n        return GameWebSocketState.CLOSED;\n    }\n});\n\nmodule.exports = {\n    GameWebSocketState: GameWebSocketState,\n    GameWebSocketDelegate: GameWebSocketDelegate,\n    GameWebSocketInterface: GameWebSocketInterface,\n    GameWebSocket: GameWebSocket\n};"]}